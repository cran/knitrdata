<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David M. Kaplan" />

<meta name="date" content="2020-07-07" />

<title>Building standalone Rmarkdown documents using the data language engine</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Building standalone Rmarkdown documents using the data language engine</h1>
<h4 class="author">David M. Kaplan</h4>
<h4 class="date">2020-07-07</h4>



<p>This document provides a brief introduction to how to use the <code>knitrdata</code> package to create standalone Rmarkdown documents. For examples of Rmarkdown documents using the package, please consult the <code>examples</code> directory provided with the package.</p>
<div id="conceptual-overview" class="section level2">
<h2>Conceptual overview</h2>
<p>Sometimes it would be useful to make completely standalone Rmarkdown documents that do not depend on data in external files. One important example of this is scientific publications written in Rmarkdown for which we often would like to supply the source document with the data to ensure results are reproducible. The <code>knitrdata</code> package addresses this need by creating a mechanism for incorporating arbitrary text and binary data in Rmarkdown documents. It works conceptually and technically in a manner that is very similar to how images and other binary data are incorporated into standalone HTML web pages: data are incorporated into specially delimited chunks that consist of the data themselves plus a small bit of header information explaining how the data are to be processed. Text data (e.g., CSV data tables, BibTeX references, LaTeX style files) is typically incorporated in chunks as is, whereas binary data (e.g., RDS files, images, NetCDF files) is encoded as text using one of two standard encoding schemes. During knitting of the Rmarkdown document, chunk data is decoded if necessary, after which it can either be loaded into the Rmarkdown R session or saved to an external file.</p>
<p><code>knitrdata</code> achieves this by extending <code>knitr</code> to provide a new <code>data</code> language engine. Instead of putting code inside <code>data</code> chunks, one puts the contents of the data file that one wishes to use in your Rmarkdown document. For binary data, the package currently supports two standard encoding formats: <code>base64</code>, the standard binary encoding format used (behind the scenes) for things like email attachments and standalone HTML web pages; and <code>gpg</code>, a well-known encryption algorithm that prevents data from being accessed by users without the appropriate decryption key. The latter option requires that a GPG keyring for managing encryption keys be installed and properly configured.</p>
<p><code>data</code> chunks do not produce output in the form of text or figures as most code chunks do. Instead, the decoded contents of the chunk are either returned as a variable in the R workspace or saved to an external file.</p>
</div>
<div id="installation-getting-started" class="section level2">
<h2>Installation &amp; getting started</h2>
<p><code>knitrdata</code> can be installed from its <a href="https://github.com/dmkaplan2000/knitrdata">github repository</a> using the package <a href="https://cran.r-project.org/package=remotes">remotes</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;dmkaplan2000/knitrdata&quot;</span>,<span class="dt">build_vignettes=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>Once the package is installed, it needs to be loaded in the Rmarkdown script before the first <code>data</code> chunk, typically in the <code>setup</code> chunk at the start of the document:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(knitrdata)</span></code></pre></div>
<p>To ensure that your document is as standalone as possible, you can combine these two steps in the <code>setup</code> chunk (though this may install packages without asking the user):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># If package not installed, install it</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;knitrdata&quot;</span>)) {</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;remotes&quot;</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;dmkaplan2000/knitrdata&quot;</span>,<span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)  </span>
<span id="cb3-6"><a href="#cb3-6"></a>}</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">library</span>(knitrdata) <span class="co"># load package</span></span></code></pre></div>
<p>After the package is installed, <code>data</code> chunks can be incorporated in the document. The precise format for <code>data</code> chunks is described in the <a href="#chunks">“Data chunks”</a> Section, but beforehand encoding of binary data is presented. If you are only interested in incorporating text data in your Rmarkdown document, then you can safely skip directly to the <a href="#chunks">“Data chunks”</a> Section.</p>
</div>
<div id="encode" class="section level2">
<h2>Encoding data</h2>
<p>Both text and binary data files can be encoded, but encoding is only required or regularly used for binary data. Two encoding formats are currently implemented: <code>base64</code>, used for non-sensitive data; and <code>gpg</code>, allowing one to encrypt data so that only users with the decryption key have access. The latter option requires that a GPG keyring be installed and properly configured.</p>
<p>Two helper functions, <code>data_encode</code> and <code>data_decode</code>, are included in the package to facilitate encoding and decoding of data files. These are basically wrapper functions for functionality provided by the <a href="https://cran.r-project.org/package=base64enc">base64enc</a> and <a href="https://cran.r-project.org/package=gpg">gpg</a> packages. To demonstrate their use, we will use the following simple data frame that exists in both text (CSV) and binary (RDS) formats:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>D =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="dt">b=</span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">write.csv</span>(D,<span class="st">&quot;test.csv&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">saveRDS</span>(D,<span class="st">&quot;test.RDS&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>D</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;   a b</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
<p>The contents of the CSV file are as follows:</p>
<pre><code>a,b
1,a
2,b
3,c</code></pre>
<p>This CSV text will be used as is in <code>data</code> chunks (see <a href="#chunks">“Data chunks”</a> Section for details).</p>
<div id="base64" class="section level3">
<h3>Base64</h3>
<p>Base64 encoding is the standard encoding to be used for all non-sensitive binary data. It is based on translating 6-bits of information into one of 64 alphanumeric and symbolic characters.</p>
<p>Encoding in base64 using the <code>data_encode</code> function works as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>b64 =<span class="st"> </span>knitrdata<span class="op">::</span><span class="kw">data_encode</span>(<span class="st">&quot;test.RDS&quot;</span>,<span class="st">&quot;base64&quot;</span>)</span></code></pre></div>
<p>By default this function will silently return the encoded data as a character string. This character string can then be visualized using the <code>cat</code> function so that it can be copied and pasted directly into a <code>data</code> chunk:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">cat</span>(b64)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#&gt; H4sIAAAAAAAAA4vgYmBgYGZgYWBiYGYFMhlYQ0PcdC2AYsJADhMQv4PSjEBFnECa</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; Lzk/tyAxuSQ+M6+kOLUQTZYlKbE4FSrGCxaH0P9AOkFWOXAwgIH9B1QaqkYA6hyQ</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; WYyJMEYSjJEMtAHZOta8xNzUYqg+Jiz60JQn5yQWw5TDBLlSEksS9dKKgCahKecs</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; yi/Xg9kA8gVTA5D4////X5BrAbFYlHo7AQAA</span></span></code></pre></div>
<p>This is only practical for relatively small data files, so for larger files, one can place the output in a file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">data_encode</span>(<span class="st">&quot;test.RDS&quot;</span>,<span class="st">&quot;base64&quot;</span>,<span class="dt">output=</span><span class="st">&quot;test.RDS.base64&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;test.RDS.base64&quot;</span>),<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; Warning in readLines(&quot;test.RDS.base64&quot;): incomplete final line found on</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; &#39;test.RDS.base64&#39;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; H4sIAAAAAAAAA4vgYmBgYGZgYWBiYGYFMhlYQ0PcdC2AYsJADhMQv4PSjEBFnECa</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; Lzk/tyAxuSQ+M6+kOLUQTZYlKbE4FSrGCxaH0P9AOkFWOXAwgIH9B1QaqkYA6hyQ</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; WYyJMEYSjJEMtAHZOta8xNzUYqg+Jiz60JQn5yQWw5TDBLlSEksS9dKKgCahKecs</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; yi/Xg9kA8gVTA5D4////X5BrAbFYlHo7AQAA</span></span></code></pre></div>
<p>Though it is rarely necessary to call the <code>data_decode</code> function directly when working with the <code>data</code> chunks in Rmarkdown documents, bas64 encoded data can be decoded as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>rds =<span class="st"> </span><span class="kw">data_decode</span>(b64,<span class="st">&quot;base64&quot;</span>,<span class="dt">as_text=</span><span class="ot">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">writeBin</span>(rds,<span class="st">&quot;test_output.RDS&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>y =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;test_output.RDS&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>y</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;   a b</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
</div>
<div id="gpg" class="section level3">
<h3>GPG</h3>
<p>Ecryption of data using GPG requires a properly configured GPG keyring. The functioning of GPG and GPG keyrings is beyond the scope of this document, but numerous websites explain how GPG works and how to install a GPG keyring, including the main <a href="https://gnupg.org/">gpg</a> website.</p>
<p>For the purposes of this vignette, I will generate a test GPG private-public key pair using the <a href="https://cran.r-project.org/package=gpg">gpg</a> package, however in real use scenarios proper keys would typically be generated using the <code>gpg</code> command line tool (or an equivalent alternative) with appropriate options.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>id =<span class="st"> </span>gpg<span class="op">::</span><span class="kw">gpg_keygen</span>(<span class="st">&quot;test&quot;</span>,<span class="st">&quot;test@test.org&quot;</span>)</span></code></pre></div>
<p>Next one uses this key to encode a data file:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>enc =<span class="st"> </span><span class="kw">data_encode</span>(<span class="st">&quot;test.RDS&quot;</span>,<span class="st">&quot;gpg&quot;</span>,<span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">receiver=</span>id))</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">cat</span>(enc)</span></code></pre></div>
<p>Note that the ID of the desired encryption key must be supplied as the <code>receiver</code> in the <code>options</code> list input argument.</p>
<p>Decoding works as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>rds =<span class="st"> </span><span class="kw">data_decode</span>(enc,<span class="st">&quot;gpg&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">writeBin</span>(rds,<span class="st">&quot;test_output.RDS&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>y =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;test_output.RDS&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>y</span></code></pre></div>
<p>Note that there is no need to supply the receiver ID when decoding because the appopriate private key is in the keyring.</p>
<p>We can delete the public-private key pair we created for this exercise from our keyring as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>gpg<span class="op">::</span><span class="kw">gpg_delete</span>(id,<span class="dt">secret=</span><span class="ot">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="chunks" class="section level2">
<h2>Data chunks</h2>
<p>Data is incorporated into Rmarkdown documents using <code>data</code> chunks that consist of the data themselves preceded by a header containing a set of special chunk options describing how the data is to be processed.</p>
<div id="text-data-chunks" class="section level3">
<h3>Text data chunks</h3>
<p>The simplest possible <code>data</code> chunk is a text data chunk containing plain text. Textual data can be directly placed into a data chunk in an Rmarkdown document as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1"></a><span class="bn">```{data output.var=&quot;d&quot;}</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="bn">a,b</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="bn">1,a</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="bn">2,b</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="bn">3,c</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="bn">```</span></span></code></pre></div>
<p>When the Rmarkdown document is knitted, this chunk will put the text contents of the chunk into the variable <code>d</code>, which will then contain the chunk contents as a character string. For the example CSV data above, the character string can then be converted into a <code>data.frame</code> using <code>read.csv</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">read.csv</span>(<span class="dt">text=</span>d)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt;   a b</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
<p>One can also load the data directly into a <code>data.frame</code> using the <code>loader.function</code> chunk option. The <code>loader.function</code> should be a function (or a character string containing the name of a function) whose first input argument will be the name of a file. A file containing the (decoded) <code>data</code> chunk contents will be passed to this function and the output will be assigned to the variable name contained in <code>output.var</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1"></a><span class="bn">```{data output.var=&quot;d&quot;,loader.function=read.csv}</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="bn">a,b</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="bn">1,a</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="bn">2,b</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="bn">3,c</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="bn">```</span></span></code></pre></div>
<p>This will assign to <code>d</code> the output of <code>read.csv</code> applied to the CSV data in the chunk.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>d</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co">#&gt;   a b</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
<p>Additional input arguments can be passed to <code>loader.function</code> by supplying a list as the <code>loader.ops</code> chunk option:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1"></a><span class="bn">```{data output.var=&quot;d&quot;,loader.function=read.csv,loader.ops=list(header=FALSE)}</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="bn">a,b</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="bn">1,a</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="bn">2,b</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="bn">3,c</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="bn">```</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>d</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">#&gt;   V1 V2</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">#&gt; 1  a  b</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt; 2  1  a</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt; 3  2  b</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt; 4  3  c</span></span></code></pre></div>
<p>Note that in this case the first line of the CSV data has been treated as data instead of as a header because we supplied the <code>header=FALSE</code> optional argument.</p>
</div>
<div id="text-documents-in-data-chunks" class="section level3">
<h3>Text documents in data chunks</h3>
<p>The <em>data</em> inside a text <code>data</code> chunk does not have to be scientific data. It can be any textual information, including the contents of formatting files used by Rmarkdown to generate final output documents. These include BibTeX files with references, LaTeX style files (.cls) and bibliography style files (.csl). For example, if we include the following in a Rmarkdown document:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1"></a><span class="bn">```{data output.file=&quot;references.bib&quot;,echo=FALSE}</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="bn">@article{MeynardTestingmethodsspecies2019,</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="bn">  ids = {MeynardTestingmethodsspecie,MeynardTestingmethodsspeciesinpress},</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="bn">  title = {Testing Methods in Species Distribution Modelling Using Virtual Species: What Have We Learnt and What Are We Missing?},</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="bn">  shorttitle = {Testing Methods in Species Distribution Modelling Using Virtual Species},</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="bn">  author = {Meynard, Christine N. and Leroy, Boris and Kaplan, David M.},</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="bn">  year = {2019},</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="bn">  month = dec,</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="bn">  volume = {42},</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="bn">  pages = {2021--2036},</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="bn">  issn = {0906-7590, 1600-0587},</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="bn">  doi = {10.1111/ecog.04385},</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="bn">  file = {/home/dmk/papers/meynard.et.al.2019.testing_methods_in_species_distribution_modelling_using_virtual_species.pdf},</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="bn">  journal = {Ecography},</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="bn">  keywords = {artificial species,environmental niche models,niche,simulations,species distribution modelling,virtual ecologist},</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="bn">  language = {en},</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="bn">  number = {12}</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="bn">}</span></span>
<span id="cb20-19"><a href="#cb20-19"></a></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="bn">@article{SantosConsequencesdriftcarcass2018,</span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="bn">  title = {Consequences of Drift and Carcass Decomposition for Estimating Sea Turtle Mortality Hotspots},</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="bn">  author = {Santos, Bianca S. and Kaplan, David M. and Friedrichs, Marjorie A. M. and Barco, Susan G. and Mansfield, Katherine L. and Manning, James P.},</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="bn">  year = {2018},</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="bn">  month = jan,</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="bn">  volume = {84},</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="bn">  pages = {319--336},</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="bn">  issn = {1470-160X},</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="bn">  doi = {10.1016/j.ecolind.2017.08.064},</span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="bn">  copyright = {All rights reserved},</span></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="bn">  file = {/home/dmk/papers/santos.et.al.2018.consequences_of_drift_and_carcass_decomposition_for_estimating_sea_turtle.pdf},</span></span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="bn">  journal = {Ecological Indicators},</span></span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="bn">  keywords = {Carcass decomposition,Chesapeake bay,Conservation,Drift leeway,Drift simulations,Endangered species,Sea turtle mortality,Sea turtle strandings}</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="bn">}</span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="bn">```</span></span></code></pre></div>
<p>This will generate the file <code>references.bib</code> from the chunk contents. Note that one uses <code>output.file</code> instead of <code>output.var</code> to save the contents to a file.</p>
<p>As style files like the BibTeX file described above are only used by knitr/pandoc in the final formatting phase of generating an output document, these files can be generated from <code>data</code> chunks during the initial phases of the knitting. This allows them to be stored inside the Rmarkdown document itself, with no need for the external file prior to knitting.</p>
</div>
<div id="base64-encoded-binary-data-chunks" class="section level3">
<h3>Base64-encoded binary data chunks</h3>
<p>Base64 encoded binary data is incorporated into a chunk by copying the output of the <code>data_encode</code> function into the chunk and supplying the <code>format=&quot;binary&quot;</code> chunk option:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1"></a><span class="bn">```{data output.var=&quot;b&quot;,format=&quot;binary&quot;,echo=FALSE}</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="bn">H4sIAAAAAAAAA4vgYmBgYGZgZgNiViCTgTU0xE3XAigmDOQwAfE7KM3IwMLACaT5</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="bn">kvNzCxKTS+Iz80qKUwvRZFmSEotToWK8YHEI/Q+kE2SVAwcDGNh/QKUhaph5wc6B</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="bn">6GOCsFmQzWfLSS1LzSkGsgTAshBRxkQYIwnGSEbTyJqck1gM0wc3LQ3okfwiiN2o</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="bn">yvMSc1NhypmwWANWzvIfzUCulMSSRL20IqBmNAM5i/LL9WCGgnzJ1AAk/v///xdk</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="bn">OwBVQunahwEAAA==</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="bn">```</span></span></code></pre></div>
<p>This will place the decoded contents of the chunk into a <code>raw</code> vector <code>b</code>. Note that <code>format</code> must be specified as <code>&#39;binary&#39;</code> and that we have chosen <code>echo=FALSE</code> to avoid including lots of ugly encoded content in our formatted document. By default, when <code>format=&quot;binary&quot;</code>, it is assumed that <code>encoding=&quot;base64&quot;</code>, but this can also be supplied as a chunk option for additional clarity.</p>
<p>The contents of the raw vector <code>b</code> must be written to a file before they can be read back into the Rmarkdown session:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">writeBin</span>(b,<span class="st">&quot;test_output.RDS&quot;</span>)</span></code></pre></div>
<p>We can combine the decoding and the writing steps by specifying the <code>output.file</code> chunk option instead of <code>output.var</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1"></a><span class="bn">```{data output.file=&quot;test_output.RDS&quot;,format=&quot;binary&quot;,echo=FALSE}</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="bn">H4sIAAAAAAAAA4vgYmBgYGZgZgNiViCTgTU0xE3XAigmDOQwAfE7KM3IwMLACaT5</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="bn">kvNzCxKTS+Iz80qKUwvRZFmSEotToWK8YHEI/Q+kE2SVAwcDGNh/QKUhaph5wc6B</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="bn">6GOCsFmQzWfLSS1LzSkGsgTAshBRxkQYIwnGSEbTyJqck1gM0wc3LQ3okfwiiN2o</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="bn">yvMSc1NhypmwWANWzvIfzUCulMSSRL20IqBmNAM5i/LL9WCGgnzJ1AAk/v///xdk</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="bn">OwBVQunahwEAAA==</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="bn">```</span></span></code></pre></div>
<p>This will save the decoded data to the filename given by <code>output.file</code>. Then this file can be read back into the Rmarkdown session:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">readRDS</span>(<span class="st">&quot;test_output.RDS&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co">#&gt;   a b</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
<p>Finally, we can combine all three steps (decoding, writing to disk, reading back into R) using the <code>loader.function</code> chunk option:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1"></a><span class="bn">```{data output.var=&quot;b&quot;,format=&quot;binary&quot;,echo=FALSE,loader.function=readRDS}</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="bn">H4sIAAAAAAAAA4vgYmBgYGZgZgNiViCTgTU0xE3XAigmDOQwAfE7KM3IwMLACaT5</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="bn">kvNzCxKTS+Iz80qKUwvRZFmSEotToWK8YHEI/Q+kE2SVAwcDGNh/QKUhaph5wc6B</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="bn">6GOCsFmQzWfLSS1LzSkGsgTAshBRxkQYIwnGSEbTyJqck1gM0wc3LQ3okfwiiN2o</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="bn">yvMSc1NhypmwWANWzvIfzUCulMSSRL20IqBmNAM5i/LL9WCGgnzJ1AAk/v///xdk</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="bn">OwBVQunahwEAAA==</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="bn">```</span></span></code></pre></div>
<p>Given these options, during knitting, the contents of the data chunk will be decoded, written to a temporary file as binary data and then read back into the R session using the <code>readRDS</code> function. In the end, the variable whose name is given by <code>output.var</code> will be assigned the output of <code>readRDS</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>b</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">#&gt;   a b</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">#&gt; 2 2 b</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">#&gt; 3 3 c</span></span></code></pre></div>
</div>
<div id="gpg-encoded-data-chunks" class="section level3">
<h3>GPG-encoded data chunks</h3>
<p>GPG chunks work similar to base64 chunks except that one must specify <code>encoding=&quot;gpg&quot;</code>. To demonstrate this functionality, we first import into the GPG keyring the private key previously used to encode some data. We would never include the private key in an Rmarkdown document in a real use case, but this is practical for this vignette and it demonstrates another use of text <code>data</code> chunks.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1"></a><span class="bn">```{data key,output.file=&quot;key&quot;,include=FALSE}</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="bn">-----BEGIN PGP PRIVATE KEY BLOCK-----</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="bn">lQVYBF6A3p8BDADcaf7tveXZUpi0IfEpmYrPP8/OSXSh3iBkd5bdTvbq/FwLGIsD</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="bn">dp/dFqAWS+0BqCIMFAtV63FUOG4kXYpkajdl2QU1Hy0aY9F9K0imc5JUM1SEry5F</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="bn">CckjzDFp3u4pmmCPWKF2jVnaHzahJfKz9J9qD9BfBSynfyQU2XgsrRqNgiqeNcOi</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="bn">f0674hpReawnecBwhENKMWL38O1aOtP1IDx9cFI6busiiOaIHIYYW6qbv178offy</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="bn">0OWogstsQ3EJQbPBPkkgVTn8wwGUtoorc/2AonSoz99QC4nMWbBaDUGuE9O32yRv</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="bn">Q7Pe6bWVBuIeV5ASAfSSEypzNHB576BF6MTy+lJvhfXI41Yu97geQJM0CplJ8xav</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="bn">xAhIvrKjkDoW3zwrZlG54G2TidwEyXoDx7cyRVnCf9tsBCmhEDiKvzlg2IE9Fo65</span></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="bn">+LWrD12qCKi7cu4XE28q4zy7S4adhUCBcuflZ8wKMVvbZRXvqnAHBAK8gQxMqHMc</span></span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="bn">EjWAb7rvmN9bkTUAEQEAAQAL/if4vPeGYaGIvhKkuSRvKOIu01O4tIMKUluF6IEX</span></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="bn">6eVxgIuulr85CwLAMKX6fO+4+vuvwuKBARth5G+J2ygcrxE0SyJ4FejcQ0hsyg8N</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="bn">lHLaoDAzyLNSc/ye8jMd75jx2yMD0rw6JBpPYMvWou4JpcNJPOOOf6ucfgGd8pI/</span></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="bn">jjotaecpHuJgLfoapeUyqIq8JK8C/WT+EdGfCpw7YObqQq4I6ZCZPuETbKMwcQ0H</span></span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="bn">yqfWC7bK9Lk/MvbdSWDH1j70f/t1KaUEBZ2z5xTALqxaFgbwXh+7FybzV+09Sxsn</span></span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="bn">l5deeubEQXwkbPthapjRpvRo197tJRHLJ8wQVCwag39ip5cvuWQIsej3qILKTepz</span></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="bn">VBdgZa4hIyLX8uUCAtLrVYwvWzV1oWxPLAkXJ6KPCzB0jQb7q7UUyrBOUaavdnt2</span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="bn">aWBz5EuXPTaMqnzWqEKIazcXqiCSNjIEv7HWcU734IGUazYper3poYgOWYYIdUes</span></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="bn">+xbdWP/j6313N3u4a9BSd3PMvQYA4CLwr+gBfX+dybX3jq3ldB3HJS/Lv90e64rh</span></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="bn">BarRu+ByyEO5BcVJZ+ZEUOcBjF/pvG1qI9mfqBuZX/e2aW1lmMsxcXNlWRu5b5vE</span></span>
<span id="cb27-22"><a href="#cb27-22"></a><span class="bn">geoRwqPMNIo4JIo2hByHZeEPQLcYW/QRy5xkoNbl+udPuS3PMEUnfnPeQKursY71</span></span>
<span id="cb27-23"><a href="#cb27-23"></a><span class="bn">ao7Zo0TUeFRemEgkvxZpFXfT+IMs9DGI/Wi6PO0ChSJ/Cu/QixgK0eJFUroNCyvl</span></span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="bn">bW+xy0GSB325wkyOM5xIny681KtvBgD7v5V6n0P2UucxZYU5hhdWaaTf5aF83vtE</span></span>
<span id="cb27-25"><a href="#cb27-25"></a><span class="bn">o88gSU5NRO1/wPFb+AFP3fw8TNtrvRlA/OakwjL+GbfhioAJ4mtPbdGUojFIAU6X</span></span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="bn">czMHbaYyNwZTMImBW9uc2gDqta8O1HiSwC7fXnTxVoSz3E/TD6dbAnFyf1FYNntJ</span></span>
<span id="cb27-27"><a href="#cb27-27"></a><span class="bn">PLKS9H82idCqO0nrU3LtdKJx9VHJ6wLOT16D6zZAdgNB0wK9dzStayfIqQzN/FAz</span></span>
<span id="cb27-28"><a href="#cb27-28"></a><span class="bn">01u0ehX4SDRCxxgukdR4ZyeZJfdmC5sF+wZ/2mW4Tp7v3kutNAytk4JtMvLIhe2r</span></span>
<span id="cb27-29"><a href="#cb27-29"></a><span class="bn">BQkYw5eUFMq7tUqXgsXMjA0pVplUSosZknCIpoyoEU7rvS9BF9xdcpRixU5kxeYY</span></span>
<span id="cb27-30"><a href="#cb27-30"></a><span class="bn">knQg5jtb+vx3Stpp0vbuvFFaGgEJhNP6Tg3al7gBCOwEEAJmSTko4cyf1e45pIMF</span></span>
<span id="cb27-31"><a href="#cb27-31"></a><span class="bn">+jGbIeozSjeKPWjdJCr4q05tvKgsiAe7BulgUlNhS6Ty5JyQHsiM/WZTPko2BsN2</span></span>
<span id="cb27-32"><a href="#cb27-32"></a><span class="bn">8Apa/nuOvYwRwFLGGXVVWV3jQroPI9Hbft9ctBhUZXN0IEtleSA8dGVzdEB0ZXN0</span></span>
<span id="cb27-33"><a href="#cb27-33"></a><span class="bn">Lm9yZz6JAdQEEwEKAD4WIQTvl6O3A7Tx/z8NeR/qzEhnRW4g7QUCXoDenwIbAwUJ</span></span>
<span id="cb27-34"><a href="#cb27-34"></a><span class="bn">A8JnAAULCQgHAgYVCgkICwIEFgIDAQIeAQIXgAAKCRDqzEhnRW4g7WxrC/94WT6J</span></span>
<span id="cb27-35"><a href="#cb27-35"></a><span class="bn">HEEgyb9Bskm2ik+c/qUW8w7JgizYRi6jqi8+qiIesh99MZ/XPm5mgMTIvKr0z/IG</span></span>
<span id="cb27-36"><a href="#cb27-36"></a><span class="bn">xaU+RKYFF5DqsAc4obg/ZmClOSY9FgDWlMEm7hEqourQxfJZXGWRNcU6DTr2tC/K</span></span>
<span id="cb27-37"><a href="#cb27-37"></a><span class="bn">GpTNkhR802LnjUePeVJU5MMuJ8eyQV+NgGhwXTIcPA6ERwHIC1n24N3QDFNoijcc</span></span>
<span id="cb27-38"><a href="#cb27-38"></a><span class="bn">pTi5p9+N33w8fBC5ZMeZwrWI6mCJjEWVbxG2zcsIJ2t7htWRM7W1rKi5lHRpQdn/</span></span>
<span id="cb27-39"><a href="#cb27-39"></a><span class="bn">cd9WtbdDFj7ywGPnjMB2vxYVJreENGbE/LZIZPaJKJHPReWQ+GBSGkyY7nrT32SP</span></span>
<span id="cb27-40"><a href="#cb27-40"></a><span class="bn">R+qj5gO0Bez7F+61EDU+SXP9PJ8fyTGtUWfTsgz+fTj2TDn39y0tL1wuSciEOAjD</span></span>
<span id="cb27-41"><a href="#cb27-41"></a><span class="bn">uia+L5qiKE9GK6mBQv78yfzZ/ZOEdJn9ZNRWs8kvs/aG9BygYMdJM5T4vvk2DcWd</span></span>
<span id="cb27-42"><a href="#cb27-42"></a><span class="bn">m061EGTg/AVUFpMuTon9tb+RCIFfVjSzat8LWcf4Me2nJeFZu+lW/lCmxkedBVgE</span></span>
<span id="cb27-43"><a href="#cb27-43"></a><span class="bn">XoDenwEMANPff6PrZirginP4HNK7g3ANmB3bDKCI1msAQspXMzvhtMc0Hn8DpM+r</span></span>
<span id="cb27-44"><a href="#cb27-44"></a><span class="bn">wPUuoOo4hnYwkGHSNZ4dulrtW99mlzQWcFwDuOsvPAqc/OuEIEo0BBvc5HcpNk4d</span></span>
<span id="cb27-45"><a href="#cb27-45"></a><span class="bn">z94Vno+Dq904VnlStf6DXpGbBFZkZBoC4XVwFUSoEjD1i967ckjFUhOxE5ynlcMb</span></span>
<span id="cb27-46"><a href="#cb27-46"></a><span class="bn">8mpS65iml4JFd572bcuo9exJ1g7IhdgFIFoDDD2eJkxEhmEHNiVd8B9/j1GHxDCq</span></span>
<span id="cb27-47"><a href="#cb27-47"></a><span class="bn">v/D0HNbgKuFk8WJUMYvupdqA30wAc5Ujnf+nURfNejgZTOiGXm5FZBrw/dha7yTP</span></span>
<span id="cb27-48"><a href="#cb27-48"></a><span class="bn">/mlnNFMBKUEBrxYyPo2JVSsYfPf1WzLL1dmv8JPC5fyEKYhEC+zBvlytRWqkZV88</span></span>
<span id="cb27-49"><a href="#cb27-49"></a><span class="bn">DumgVEdhEnnMEVlofyF8KoVMmWYA9w/FUUKiNymZlK1PEGecqliEhXh+KE03ncHh</span></span>
<span id="cb27-50"><a href="#cb27-50"></a><span class="bn">AyEo0Zcdh5sSxUW5fNsQb+tp0fqFBs7Yye432w6ID3ZIONrnWrQ6MewWwxeAGMam</span></span>
<span id="cb27-51"><a href="#cb27-51"></a><span class="bn">x03jgyMlCwARAQABAAv9EJ0e8iicS1JuKOfUwsWHafr26ahqlhAE2EEd+6XY06JA</span></span>
<span id="cb27-52"><a href="#cb27-52"></a><span class="bn">PbqdhZIwk0RBjjhIz/T8vjnSqIkGQU7NdSHVqW/u/VuhFeYI0xBSIfbrckBbE9Z+</span></span>
<span id="cb27-53"><a href="#cb27-53"></a><span class="bn">V/z7QUjPBFMcIKsLUu+dQ2yOg1b0BHAis0I3ldqrasq9CStvz4FqY8JtZFrIfGJU</span></span>
<span id="cb27-54"><a href="#cb27-54"></a><span class="bn">rEyfYBJYEQOY/7Ne3Ap8KO/vkFx8gZLPLecgTOp2bFkCj2xbwl0rXaGl8+fP3CBA</span></span>
<span id="cb27-55"><a href="#cb27-55"></a><span class="bn">mweyok8GGFbbVDagKE1NiukpEVzHsoMyMfPkxdIMLSj0F2GzQSnhyhyGomNstuTT</span></span>
<span id="cb27-56"><a href="#cb27-56"></a><span class="bn">EC/i3/u7M9TRvLkpNTP3I6z5VNjayrp0NBs0z3sb1wNzrACELWbTtb/Lo5BVVD9Y</span></span>
<span id="cb27-57"><a href="#cb27-57"></a><span class="bn">m0MQtDi8+SKzTHci2AdpvewxnhO4IiS/aXYYGcPwmEX4YdlZeV0J5mRXNsvWxYZk</span></span>
<span id="cb27-58"><a href="#cb27-58"></a><span class="bn">HHFkbfgUkiFSFOmb9uyPD0NMldJoLXbv9+LFiU1okglietVcKK7Fyt5xCKcxbtO8</span></span>
<span id="cb27-59"><a href="#cb27-59"></a><span class="bn">kdYJTuWonsWeyC8tz1WBBgDcq6doxs3aFSVeLcZ0//WHif+iBYlLFoexmw4irx8e</span></span>
<span id="cb27-60"><a href="#cb27-60"></a><span class="bn">LnZilDJ5i4mwcu6Q5qxao3UEyeUC7ff//Qn846TQMDDRcC3xtrbqAqVyYBE7u9EI</span></span>
<span id="cb27-61"><a href="#cb27-61"></a><span class="bn">OMyyCfosk8nNmVBpNdnsFm76lUyG8GiuT6b0j8BiQTRPmH4Xlh3pSiihyuTJIVhX</span></span>
<span id="cb27-62"><a href="#cb27-62"></a><span class="bn">Y663wV8EwT9IRnYCoVqw9s5qZqJGkI4rxnABuyJui4BpmkrLry70t1xb6MdX2BPD</span></span>
<span id="cb27-63"><a href="#cb27-63"></a><span class="bn">eK5u0YJ24AmxPW5YGvXnO0sGAPXLRfarrI9IgSz28+QpfYttOIbjp3n3AxB3ImHo</span></span>
<span id="cb27-64"><a href="#cb27-64"></a><span class="bn">oK+CLsc1vHtsdEV8hElWo9k5EqcdlhPBbeC6IILFqT69Ldx8jK85hxR0bYs2NVLC</span></span>
<span id="cb27-65"><a href="#cb27-65"></a><span class="bn">qyWo1T3bovPePCEenN4++VPBtVBkEt51MByNIKwC3Bw0zvHcygLcHE3iXRQ40dhq</span></span>
<span id="cb27-66"><a href="#cb27-66"></a><span class="bn">AZWrPlOqwnC8x9+UqZoWCp/JRWD5qBjD6EPVAxwbtcUdjDOhZ1y51xbUaX59Vlul</span></span>
<span id="cb27-67"><a href="#cb27-67"></a><span class="bn">BGLse/0Q47m71HrF+d9rGUnlQQYAkDQsdbzijmB/tVzcRXJWbZVgjwLciofxVpoM</span></span>
<span id="cb27-68"><a href="#cb27-68"></a><span class="bn">TEYyw8+oSYDI1L3Dikejp3XymVr+9pKGmPZjLqL9Q01J9epeHt5wgLjuWTXtkVLW</span></span>
<span id="cb27-69"><a href="#cb27-69"></a><span class="bn">kbnt7vTy257BIsHGDwiJzMI7PujTlQ4B1ZTPz2WyUJ7gn1f+J9wYpNOr7qeE2pg6</span></span>
<span id="cb27-70"><a href="#cb27-70"></a><span class="bn">cOeiPQmT5h88jWTUH/eAJ0nAWx46kwgQY4uZz7xsFtCcwQgqVe9bD5MNv/bBUdPW</span></span>
<span id="cb27-71"><a href="#cb27-71"></a><span class="bn">RkF8ZbRCPRk4Vl2DYM/rXC2VGCFZ6OeJAbYEGAEKACAWIQTvl6O3A7Tx/z8NeR/q</span></span>
<span id="cb27-72"><a href="#cb27-72"></a><span class="bn">zEhnRW4g7QUCXoDenwIbDAAKCRDqzEhnRW4g7ZayC/954y+kfmjtIzSRDBRpOo2s</span></span>
<span id="cb27-73"><a href="#cb27-73"></a><span class="bn">npOOwy7RLdOdWvab6jVecyqYsDyd/fiCXVKxALOVR31WTef00iFSLHQactwFxQyJ</span></span>
<span id="cb27-74"><a href="#cb27-74"></a><span class="bn">zY6YO8tGkvYEXXYJR5O5MNzjlhNMndBqGIbKe9tA2BFLDD/6mmvMD/i9k+IhHzFT</span></span>
<span id="cb27-75"><a href="#cb27-75"></a><span class="bn">NhoczB5rE9oaApMZhAj9u9Uv2zy0osfcOPcy+RN9b2noodVS/7Ei2BjWl+V/MGqa</span></span>
<span id="cb27-76"><a href="#cb27-76"></a><span class="bn">I8oBM/ETIW/jcq+OuE8oSqoByFtFHh1DgOzOFugCWApOmAjLQwQCmDiYYtKN1GWq</span></span>
<span id="cb27-77"><a href="#cb27-77"></a><span class="bn">l1E+txLud78ZBsJQL/78MXO9V2T2dCbcIA0vOfACuoPApfu6seRE0SLeImgoRg+8</span></span>
<span id="cb27-78"><a href="#cb27-78"></a><span class="bn">7aX6HtiRXRjExDS26YNbGYzAvVTl3Zy1VptXOMwkh5CcIgtTcDv32pLWC3xvNydG</span></span>
<span id="cb27-79"><a href="#cb27-79"></a><span class="bn">P4xDMM+BVuDi6QTcFfbPtqYbuuT4OFyyaSzee0oWxvKoX2pL81VnMwvb7Uy47Dxf</span></span>
<span id="cb27-80"><a href="#cb27-80"></a><span class="bn">Ng9Af4cf3nf9UzesAVbSy1gtvlZIyX0HwtZNVLNJSS4=</span></span>
<span id="cb27-81"><a href="#cb27-81"></a><span class="bn">=C6UF</span></span>
<span id="cb27-82"><a href="#cb27-82"></a><span class="bn">-----END PGP PRIVATE KEY BLOCK-----</span></span>
<span id="cb27-83"><a href="#cb27-83"></a><span class="bn">```</span></span></code></pre></div>
<p>This key then needs to be imported into the keyring:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>gpg<span class="op">::</span><span class="kw">gpg_import</span>(<span class="st">&quot;key&quot;</span>)</span></code></pre></div>
<p>Now that we have this private key, we can decode some binary data encrypted using this key:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1"></a><span class="bn">```{data t3,format=&quot;binary&quot;,encoding=&quot;gpg&quot;,output.var=&quot;d&quot;,loader.function=readRDS}</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="bn">-----BEGIN PGP MESSAGE-----</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="bn">Version: GnuPG v2</span></span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="bn">hQGMA9TPonHna5j3AQv7BIPNOSR/024iE0Gj3DCo3DvLvj/oEJ29XORHBkn4nul1</span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="bn">+zaRV5E/K4LCKxkkAEx/+FdM72x1hV5FF5Vf0FSet1RHiOOXPuChEEzRHOubkh/U</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="bn">gw44Q72d8Dp6TOJ+1KT5k/fdkVKsOZRSttL8hvxqC4nyfObF0CkIoG+Kfx+kkYqu</span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="bn">araVWqNtcb3/FbtT+ZC0Hip0Ws6IJ8mGOhZdRxZ3S8KUtgf/t7S3Wa75c6L1wolT</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="bn">R1/WhPgcWB4epLTvHdSmv9qcu/vFXE8SmNE5MV4V2aSTRU7y9WdPW/+XzU2Et4BK</span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="bn">kGyzhkI6q7QzAXFOeD1sn0uaUeH9/BDwn3AJZEXkwN4qaarPpDKjZ9GVE9Gg8521</span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="bn">BYe7AIZwq7sfnF+v1WyxamFYpSSAiNHze00MHPWot3Db+4SpRFYIWlYlZF00HIMo</span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="bn">Qspb4AmIfnNo9zj0RGG7GJoyod8ZrW4RF5iOEUWtyQ5z6LzymGTSdArWOq1fDgYW</span></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="bn">tvEgbkbdYsJA6usJ3Zxc0sBJARfA6gDCFF72nGiAoNS98zoFjtD7hznY9DBvCOoF</span></span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="bn">jzJ8kHfPQPK9/bRVuofUDP+jOoJyf8/7eB6kANNq+XrzoZL0N42zHR2n47xupqYN</span></span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="bn">GSdsRljTra8a9zWIs9k8E5/79qRvV25c/wPeysulWkzhLCDaCMMVYJvQQ0JgT2L+</span></span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="bn">/eBtDeAuqkCqiDjeEGGB0Q4Q81IOIHMxUXFPJHvWJE4eJhnRjLmuPCBDQdL0JYTS</span></span>
<span id="cb29-17"><a href="#cb29-17"></a><span class="bn">Bc48A/eA/cbfUr+4RluY9RLcaUHRPjKT8e7X98VdnSBPGvikVpSjR3zZhPNQs7Vb</span></span>
<span id="cb29-18"><a href="#cb29-18"></a><span class="bn">C7H5lml4B8FpRgQBFwt2ou8URLRYR82tUa/OcsByW9jxf988YZx57a1hAw==</span></span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="bn">=m4sT</span></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="bn">-----END PGP MESSAGE-----</span></span>
<span id="cb29-21"><a href="#cb29-21"></a><span class="bn">```</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>d</span></code></pre></div>
</div>
<div id="helper-functions-for-creating-and-inserting-data-chunks" class="section level3">
<h3>Helper functions for creating and inserting data chunks</h3>
<p>For small data chunks, one can copy-paste the (encoded) data from the command line or from a file into a Rmarkdown document. For larger data chunks, this can be awkward, so <code>knitrdata</code> includes two helper functions for creating and inserting <code>data</code> chunks into Rmarkdown documents: <code>create_chunk</code> and <code>insert_chunk</code>. We can combine these functions with <code>data_encode</code> to generate the base64 <code>data</code> chunk described above. First, we use <code>create_chunk</code> to generate the chunk:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">library</span>(magrittr) <span class="co"># For pipe operator</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>chunk =<span class="st"> </span><span class="kw">data_encode</span>(<span class="st">&quot;test.RDS&quot;</span>,<span class="st">&quot;base64&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="st">  </span><span class="kw">create_chunk</span>(<span class="dt">chunk_label=</span><span class="st">&quot;mydata&quot;</span>,<span class="dt">output.var=</span><span class="st">&quot;d&quot;</span>,<span class="dt">format=</span><span class="st">&quot;binary&quot;</span>,<span class="dt">echo=</span><span class="ot">FALSE</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>               <span class="dt">loader.function=</span>readRDS)</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="kw">cat</span>(chunk,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">#&gt; ```{data mydata,output.var = &quot;d&quot;, format = &quot;binary&quot;, echo = FALSE, loader.function = readRDS}</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">#&gt; H4sIAAAAAAAAA4vgYmBgYGZgYWBiYGYFMhlYQ0PcdC2AYsJADhMQv4PSjEBFnECa</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co">#&gt; Lzk/tyAxuSQ+M6+kOLUQTZYlKbE4FSrGCxaH0P9AOkFWOXAwgIH9B1QaqkYA6hyQ</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co">#&gt; WYyJMEYSjJEMtAHZOta8xNzUYqg+Jiz60JQn5yQWw5TDBLlSEksS9dKKgCahKecs</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co">#&gt; yi/Xg9kA8gVTA5D4////X5BrAbFYlHo7AQAA</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co">#&gt; ```</span></span></code></pre></div>
<p>Note that with the exception to the chunk label, chunk contents and other named arguments to this function, all the other arguments are not evaluated, so they can be given exactly as they should appear in the Rmarkdown document regardless of whether the chunk options make sense in the current context.</p>
<p>Next, we can use <code>insert_chunk</code> to place this chunk at a given line number in a Rmarkdown file (here taken to be <code>example.Rmd</code>):</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>rmd =<span class="st"> </span><span class="kw">insert_chunk</span>(chunk,<span class="dv">11</span>,<span class="dt">rmd.file=</span><span class="st">&quot;example.Rmd&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="kw">writeLines</span>(rmd,<span class="st">&quot;example_with_data_chunk.Rmd&quot;</span>)</span></code></pre></div>
<p>This will insert the new <code>data</code> chunk at line 11 in the Rmarkdown document.</p>
<p><code>knitrdata</code> also includes the <code>list_rmd_chunks</code> and <code>splice_rmd_by_chunk</code> functions for identifying and potentially removing or working with the chunks in a Rmarkdown document. See the documentation and examples for these functions for more details on their use.</p>
</div>
<div id="data-integrity-checks-using-md5sum" class="section level3">
<h3>Data integrity checks using md5sum</h3>
<p>Using the procedures above should assure that data inside <code>data</code> chunks do not have errors. Nevertheless, there is always the possibility that a stray keystroke would modify the data, particularly for binary data encoded as text. To protect against this, <code>data</code> chunks can have a <code>md5sum</code> chunk option that will be used to test if the decoded data matches expectations. A MD5 sum is essentially a very large number (typically encoded in hexadecimal) derived from a file’s contents that has a vanishingly small probability of being equal to the the equivalent number derived from a <em>different</em> file’s contents. If two files have the same MD5 sum, they are almost certainly identical.</p>
<p>To use the <code>md5sum</code> chunk option, one must first determine the MD5 sum of the <em>decoded</em> source data:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>tools<span class="op">::</span><span class="kw">md5sum</span>(<span class="st">&quot;test.RDS&quot;</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">#&gt;                           test.RDS </span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="co">#&gt; &quot;25d0446c3d2bc645aaca9dcb500dd765&quot;</span></span></code></pre></div>
<p>If this character string is given as the <code>md5sum</code> chunk option to a data chunk, then the MD5 sum of the <em>decoded</em> data of that chunk will be calculated and checked against this character string. If the two do not match, an error will be generated.</p>
<p>We can add a MD5 sum check to the <code>data</code> chunk generated in the previous section as follows:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>md5 =<span class="st"> </span>tools<span class="op">::</span><span class="kw">md5sum</span>(<span class="st">&quot;test.RDS&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a>chunk =<span class="st"> </span><span class="kw">data_encode</span>(<span class="st">&quot;test.RDS&quot;</span>,<span class="st">&quot;base64&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">  </span><span class="kw">create_chunk</span>(<span class="dt">chunk_label=</span><span class="st">&quot;mydata&quot;</span>,<span class="dt">output.var=</span><span class="st">&quot;d&quot;</span>,<span class="dt">format=</span><span class="st">&quot;binary&quot;</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>               <span class="dt">echo=</span><span class="ot">FALSE</span>,<span class="dt">loader.function=</span>readRDS,</span>
<span id="cb34-5"><a href="#cb34-5"></a>               <span class="dt">chunk_options_string =</span> <span class="kw">paste0</span>(<span class="st">&quot;md5sum=&#39;&quot;</span>,md5,<span class="st">&quot;&#39;&quot;</span>))</span>
<span id="cb34-6"><a href="#cb34-6"></a></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="kw">cat</span>(chunk,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">#&gt; ```{data mydata,output.var = &quot;d&quot;, format = &quot;binary&quot;, echo = FALSE, loader.function = readRDS, md5sum=&#39;25d0446c3d2bc645aaca9dcb500dd765&#39;}</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">#&gt; H4sIAAAAAAAAA4vgYmBgYGZgYWBiYGYFMhlYQ0PcdC2AYsJADhMQv4PSjEBFnECa</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">#&gt; Lzk/tyAxuSQ+M6+kOLUQTZYlKbE4FSrGCxaH0P9AOkFWOXAwgIH9B1QaqkYA6hyQ</span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co">#&gt; WYyJMEYSjJEMtAHZOta8xNzUYqg+Jiz60JQn5yQWw5TDBLlSEksS9dKKgCahKecs</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="co">#&gt; yi/Xg9kA8gVTA5D4////X5BrAbFYlHo7AQAA</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co">#&gt; ```</span></span></code></pre></div>
<p><code>md5sum</code> can be used on all <code>data</code> chunk types, including text <code>data</code> chunks that are not encoded in any special way.</p>
</div>
<div id="reading-a-data-chunk-from-an-external-file" class="section level3">
<h3>Reading a data chunk from an external file</h3>
<p>One disadvantage of using <code>data</code> chunks is that it can make Rmarkdown files long and difficult to navigate if you use lots of data. Rstudio can help with this problem by allowing one to hide the contents of a chunk and by using navigation tools to jump between section. In addition, using <code>insert_chunk</code> to place a <code>data</code> chunk inside a document as the last step before public diffusion may avoid having to work extensively with the large file. Nevertheless, large file size can still be a problem. To facilitate the initial construction of standalone Rmarkdown documents, data chunks can be read from external files using the <code>external.file</code> chunk option. The external file must contain the <em>encoded</em> chunk contents exactly as they would appear in a <code>data</code> chunk. The intended use of this option is that large data chunks would be placed initially in external files, but the contents of these files would be placed directly in the <code>data</code> chunks before sharing the document with others.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">writeLines</span>(<span class="kw">c</span>(<span class="st">&quot;This is from an external file.&quot;</span>,<span class="st">&quot;It has two lines.&quot;</span>),</span>
<span id="cb35-2"><a href="#cb35-2"></a>           <span class="st">&quot;test_external.txt&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1"></a><span class="bn">```{data ext,output.var=&quot;ext&quot;,external.file=&quot;test_external.txt&quot;}</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="bn">Content will be ignored with a warning!</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="bn">```</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">cat</span>(ext)</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co">#&gt; This is from an external file.</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="co">#&gt; It has two lines.</span></span></code></pre></div>
</div>
</div>
<div id="rstudio-addins-for-working-with-data-chunks" class="section level2">
<h2>Rstudio Addins for working with data chunks</h2>
<p>The steps described above for encoding data, creating data chunks and inserting them in Rmarkdown documents have been combined into a set of <code>Shiny</code> applications:</p>
<ul>
<li><code>create_data_chunk_dialog()</code> for creating a data chunk and returning it to the command line after the user specifies a data file and a set of options in the <code>Shiny</code> gadget</li>
<li><code>insert_data_chunk_dialog()</code>, which has the same functionality as <code>create_data_chunk_dialog()</code>, except that the data chunk that is created is inserted at the cursor location in the active source document in the Rstudio editor</li>
<li><code>remove_chunks_dialog()</code>, which shows a data table listing all chunks in the active source document in the Rstudio editor, allowing one to select a set of chunks (i.e., rows) and then delete those chunks with the click of a button</li>
</ul>
<p>The last two of these, <code>insert_data_chunk_dialog()</code> and <code>remove_chunks_dialog()</code>, are accessible in the Rstudio Addins menu under the <code>knitrdata</code> heading with titles <code>Insert data chunk</code> and <code>Remove chunks</code>, respectively.</p>
<p>Before using these tools, first install all the additional packages suggested by <code>knitrdata</code>: <code>shiny</code>, <code>miniUI</code>, <code>DT</code>, <code>rstudioapi</code>.</p>
<p>The use of these tools is generally self explanatory. The chunk creation apps ask for the name of the data file to be incorporated into the chunk, as well as a standard set of other chunk options, such as data format and encoding and output options. The app will attempt to suggest sensible options based on the input data file, though these can be changed afterward. For example, if a binary file is selected, then the format and encoding options will be set to <code>binary</code> and <code>base64</code> respectively. GPG encoding of data using the app is supported and will prompt the user to select the key ID(s)s of the key(s) to be used to encrypt the data. By default, <code>md5sum</code> checks of all binary data chunks will be included.</p>
<p>The chunk removal app present a searchable list of all chunks in the source document. To eliminate a set of chunks, one just selects the corresponding rows and clicks the <code>Remove chunks</code> button.</p>
<p>Note that these tools do not try to determine if the active source document is a Rmarkdown document. If undesired changes are made to a document, then one can undo (<code>ctrl-z</code>) those changes afterward.</p>
</div>
<div id="use-cases" class="section level2">
<h2>Use cases</h2>
<p>There are many potential scenarios where including data inside Rmarkdown documents can be useful. The most obvious is to render a document fully standalone, perhaps for creating a single document that reproduces an entire publication or report or to make life as simple as possible for collaborators that are not comfortable managing complex Rmarkdown documents requiring multiple files. To do this, one would place not only data inside chunks in the Rmarkdown document, but also ancillary files associated with the document, such as CSS, LaTeX and CSL (bibliography) style files, and BibTeX files. These latter chunks would typically recreate these external files using the <code>output.file</code> chunk option.</p>
<p><code>knitrdata</code> also has uses in cases where the objective is not necessarily to render a document fully standalone. One can use it as a convenient way to input small data tables and data vectors (e.g., see <a href="#vectdata">Numeric vector data</a> below) into an Rmarkdown document. For example, the <code>data</code> chunk syntax combined with CSV data may be simpler and cleaner than creating a <code>data.frame</code> or <code>tibble</code> directly in R code. Furthermore, though markdown allows one to create small tables by hand, it is difficult or impossible to reproduce the sophisticated tables that <code>knitr::kable</code> and <code>kableExtra</code> are capable of creating, and tables created in markdown may not <em>float</em> as other tables do, potentially an issue for producing scientific publications with Rmarkdown. <code>knitrdata</code> can be used as a simple way to input these tables into R, which can then be used as input to <code>kable</code> and other tools. Finally, <code>data</code> chunks provide a convenient system for making certain Rmarkdown document text conditional on parameter values or results (see <a href="#condtext">Conditional text in Rmarkdown using knitrdata</a>).</p>
<p>One <code>knitrdata</code> feature that may at first glance seem to be of little value is the possibility to <code>gpg</code> encrypt data chunks. Why would one want to encrypt just the data when one can encrypt the entire Rmarkdown document? However, there are many cases where the data themselves are confidential (e.g., economically important data, confidential medical information), but the methods used to analyze and synthesize those data can and should be publicly available. Furthermore, it is increasingly common to share code and documents on public collaboration websites, such as <a href="https://www.github.com">github</a> or <a href="https://www.slack.com">slack</a>, but one may not have sufficient confidence in the privacy protections of these websites to give them access to the data themselves.</p>
</div>
<div id="when-not-to-use-data-chunks" class="section level2">
<h2>When not to use data chunks</h2>
<p>Though the <code>knitrdata</code> package can be a powerful tool, it can also be abused by placing very large amounts of data inside Rmarkdown files. This will make the documents very large and difficult to navigate. The options to collapse <code>data</code> chunks in Rstudio, use Rstudio’s navigation tools, use <code>knitrdata</code>’s helper functions for <code>data</code> chunk creation and the use of the <code>external.file</code> chunk option all can reduce the importance of these issues, but including very large amounts of data in Rmarkdown documents is unlikely to be optimal. In particular, Rstudio currently will not open a Rmarkdown documents larger than 5 MB in size, though larger documents can still be opened by other editors and rendering from the command line using <code>rmarkdown::render</code> is always possible. Basic prudence should be used when deciding what and how much data to include in Rmarkdown documents.</p>
</div>
<div id="tt" class="section level2">
<h2>Tips &amp; tricks</h2>
<div id="vectdata" class="section level3">
<h3>Numeric vector data</h3>
<p>You can use a data chunk to load numeric vector data as follows:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1"></a><span class="bn">```{data output.var=&quot;v&quot;,line.sep=&quot;&quot;}</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="bn">1.2,3.4,5.6,</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="bn">7.8,9.0</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="bn">```</span></span>
<span id="cb38-5"><a href="#cb38-5"></a></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="bn">```{r}</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="bn">v = as.numeric(strsplit(v,&quot;,&quot;)[[1]])</span></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="bn">v</span></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="bn">```</span></span></code></pre></div>
<pre><code>#&gt; [1] 1.2 3.4 5.6 7.8 9.0</code></pre>
</div>
<div id="condtext" class="section level3">
<h3>Conditional text in Rmarkdown with missing values</h3>
<p>One way to create large amounts of text in an Rmarkdown document that is only included in the document if certain conditions are met is with the <code>asis</code> language engine. For example, if one create an input parameter in the YAML header of an Rmarkdown document:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>params<span class="op">:</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="st">  </span>cond<span class="op">:</span><span class="st"> </span><span class="ot">TRUE</span></span></code></pre></div>
<p>Then one could include content in the document based on this parameter as follows:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1"></a><span class="bn">```{asis eval=params$cond}</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="bn"># A conditional section</span></span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="bn">This **will not** be evaluated: $5+4=9$</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="bn">```</span></span></code></pre></div>
<p>This will add a section and a paragraph with one sentence. One disadvantage of this approach is that the content of an <code>asis</code> chunk is never evaluated so one cannot use inline R code.</p>
<p>This limitation can be overcome with <code>knitrdata</code> by pushing the content of the chunk into a text variable with conversion specifications that can be replaced using the <code>sprintf</code> function. For example, placing the following in the document:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1"></a><span class="bn">```{data include=FALSE,output.var=&quot;cond_text&quot;}</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="bn"># A conditional section</span></span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="bn">This **will** be evaluated: $5+4=%d$</span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="bn">```</span></span>
<span id="cb42-6"><a href="#cb42-6"></a></span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="bn">```{r results=&#39;asis&#39;,echo=FALSE,eval=params$cond}</span></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="bn">cat(sprintf(cond_text,5+4))</span></span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="bn">```</span></span></code></pre></div>
<p>Will lead to <code>%d</code> being replaced with <code>9</code>.</p>
</div>
</div>
<div id="full-list-of-data-chunk-options" class="section level2">
<h2>Full list of data chunk options</h2>
<p>In addition to the standard <code>eval</code> and <code>echo</code> chunk options, <code>knitrdata</code> supports the following chunk options:</p>
<table>
<caption>Full list of knitrdata chunk options.</caption>
<colgroup>
<col width="6%"></col>
<col width="93%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Chunk option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>format</code></td>
<td align="left">One of <code>&#39;text&#39;</code> or <code>&#39;binary&#39;</code>. Defaults to <code>&#39;text&#39;</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>encoding</code></td>
<td align="left">One of <code>&#39;asis&#39;</code>, <code>&#39;base64&#39;</code> or <code>&#39;gpg&#39;</code>. Defaults to <code>&#39;asis&#39;</code> for <code>format=&#39;text&#39;</code> and <code>&#39;base64&#39;</code> for <code>format=&#39;binary&#39;</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>decoding.ops</code></td>
<td align="left">A list with additional arguments for <code>data_decode</code>. Currently only useful for passing the <code>verify</code> argument to <code>gpg::gpg_decrypt</code> for <code>gpg</code> encrypted chunks.</td>
</tr>
<tr class="even">
<td align="left"><code>external.file</code></td>
<td align="left">A character string with the name of a file whose text contents will be used as if they were the contents of the data chunk.</td>
</tr>
<tr class="odd">
<td align="left"><code>md5sum</code></td>
<td align="left">A character string giving the correct md5sum of the <em>decoded</em> chunk data. If supplied, the md5sum of the decoded data will be calculated and compared to the supplied value, returning an error if the two do not match.</td>
</tr>
<tr class="even">
<td align="left"><code>output.var</code></td>
<td align="left">A character string with the variable name to which the chunk output will be assigned. At least one of <code>output.var</code> or <code>output.file</code> must always be supplied.</td>
</tr>
<tr class="odd">
<td align="left"><code>output.file</code></td>
<td align="left">A character string with the filename to which the chunk output will be written. At least one of <code>output.var</code> or <code>output.file</code> must always be supplied.</td>
</tr>
<tr class="even">
<td align="left"><code>loader.function</code></td>
<td align="left">A function that will be passed (as the first argument) the name of a file containing the (potentially decoded) contents of the data chunk.</td>
</tr>
<tr class="odd">
<td align="left"><code>loader.ops</code></td>
<td align="left">A list of additional arguments to be passed to <code>loader.function</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>line.sep</code></td>
<td align="left">Only used when <code>encoding=&#39;asis&#39;</code>. In this cases, specifies the character string that will be used to join the lines of the data chunk before further processing or returning them. Defaults to <code>&#39;\n&#39;</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>max.echo</code></td>
<td align="left">An integer specifying the maximum number of lines of data to echo in the final output document. Defaults to 20. If the data exceeds this length, only the first 20 lines will be shown and a final line indicating the number of ommitted lines will be added.</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
